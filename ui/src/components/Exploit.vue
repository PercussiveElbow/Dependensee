<template>
  <div id ='something'>
    <div class="app-viewport" id="file-list">
      <Sidebar ref='sidebar'></Sidebar>
      <md-whiteframe md-elevation="3" class="main-toolbar">
        <md-toolbar class="md-dense">
          <div class="md-toolbar-container">
            <md-button class="md-icon-button" @click="$refs.sidebar.toggleSidebar()"><md-icon>menu</md-icon></md-button>
            <span style="flex: 1"></span>
            <md-button class="md-icon-button"><md-tooltip md-direction="left">Search</md-tooltip><md-icon>search</md-icon></md-button>
          </div>
          <div class="md-toolbar-container">
            <md-button class="md-icon-button"  @click="$router.push({ path: '/projects/' });"><md-icon>home</md-icon></md-button>
            <h2 class="md-title">Exploit-{{$route.params.exploit_id}}</h2>
          </div>
        </md-toolbar>
    </md-whiteframe>
    <main class="main-content" style="text-align: center;">
      <div style="padding: 20px">
          <h1>{{message}}</h1></br>
          <md-button  @click="getExploit(this.$route.params.exploit_id)" style="background-color: red;" v-if="found" class="md-primary md-raised">Download Exploit</md-button>
        </br>
      </div>
    </main>
  </div>
  <CVESearch ref='cvesearch'></CVESearch>
</div>
</template>

<script>
  import {canExploit,getExploit} from '../utils/api.js';
  import Sidebar from './Sidebar'
  import CVESearch from './CveSearch'

  export default {
    name: 'Exploit',
    components:  {
      Sidebar,
      CVESearch
    },
    data() {
      return {
        message: '',
        found: false
       }
    },
    created() {
      this.can_exploit();
    },
    watch: {
      '$route': 'fetchData'
    },
    methods: {
      can_exploit() {
        this.message='No exploit found for CVE: ' + this.$route.params.exploit_id
        canExploit(this.$route.params.exploit_id).then( response => {
            if(response===200){
              this.message='Exploit found for CVE: ' + this.$route.params.exploit_id
              this.found=true
            }
        });
      }
    }
  } 
</script>

<style scoped>
html,
body,
.app-viewport {
  height: 100%;
  overflow: hidden;
}

.app-viewport {
  display: flex;
  flex-flow: column;
}

.main-toolbar {
  position: relative;
  z-index: 10;
}

.md-fab {
  margin: 0;
  position: absolute;
  bottom: -20px;
  left: 16px;
  z-index: 10;
  
  .md-icon {
    color: #fff;
  }
}

.md-title {
  padding-left: 8px;
  color: #fff;
}

.main-content {
  position: relative;
  z-index: 1;
  overflow: auto;
}
</style>
