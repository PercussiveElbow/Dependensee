# spec/requests/exploits_api_spec.rb
require 'rails_helper'

RSpec.describe 'exploits API', type: :request do
  let(:user) { create(:user) }
  let(:headers) { valid_headers }

  describe 'GET /api/v1/exploit/:id' do
    before { get "/api/v1/exploit/#{id}", params: {}, headers: headers }

    context 'when the exploit exists and we dont request download' do
      let(:id) { '2017-5638' }
      it 'returns 200' do
        expect(response).to have_http_status(200)
      end
    end

    context 'when the exploit does not exist' do
      let(:id) { '2017-1234' }
      it 'returns 404' do
        expect(response).to have_http_status(404)
      end
    end

    context 'when the id doesnt match regex' do
      let(:id) { '2017-abc123' }
      it 'returns 422' do
        expect(response).to have_http_status(422)
      end
    end

  end

  describe 'GET /api/v1/exploit/:id' do
    before { get "/api/v1/exploit/#{id}", params: {}, headers: {'Content-Type' => 'application/json', 'download' => 'no' } }

    context 'when the exploit does not exist and we dont request download' do
      let(:id) { '2017-5638' }
      it 'returns 404' do
        expect(response).to have_http_status(200)
      end
    end

  end

end

